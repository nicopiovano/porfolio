---
---

<div id="browser-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
  <div class="relative bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-md w-full mx-4 p-6 md:p-8 border border-green-200/30 dark:border-green-500/20">
    <button
      id="close-modal"
      class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
      aria-label="Cerrar modal"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
    
    <div class="flex flex-col items-center text-center">
      <div class="mb-4">
        <svg class="w-16 h-16 text-green-600 dark:text-green-400 mx-auto" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-1-11V7h2v4h-2zm0 4v2h2v-2h-2z"/>
        </svg>
      </div>
      
      <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-3">
        Recomendación de Navegador
      </h2>
      
      <p class="text-gray-700 dark:text-gray-300 mb-4 leading-relaxed">
        Esta página contiene efectos visuales 3D que funcionan mejor en <strong class="text-green-600 dark:text-green-400">Mozilla Firefox</strong>.
      </p>
      
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
        Para una experiencia óptima, te recomiendo usar Firefox.
      </p>
      
      <div class="flex gap-3 w-full">
        <a
          href="https://www.mozilla.org/es-ES/firefox/new/"
          target="_blank"
          rel="noopener noreferrer"
          class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors text-center"
        >
          Descargar Firefox
        </a>
        <button
          id="continue-anyway"
          class="flex-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium py-2 px-4 rounded-lg transition-colors"
        >
          Continuar
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  function initBrowserModal() {
    const modal = document.getElementById('browser-modal')
    const closeBtn = document.getElementById('close-modal')
    const continueBtn = document.getElementById('continue-anyway')
    
    if (!modal || !closeBtn || !continueBtn) return
    
    // Detectar si es Firefox
    const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1
    
    // Si no hay sesi?n activa, limpiar localStorage de efectos deshabilitados
    // Esto asegura que cada nueva sesi?n empiece limpia
    if (!sessionStorage.getItem('disable-3d-effects-session')) {
      localStorage.removeItem('disable-3d-effects')
    }
    
    // Verificar si el modal ya se mostr? en esta sesi?n
    const modalShownThisSession = sessionStorage.getItem('browser-modal-shown-session')
    
    // Mostrar modal siempre si no es Firefox y no se ha mostrado en esta sesi?n
    if (!isFirefox && !modalShownThisSession) {
      modal.classList.remove('hidden')
      modal.classList.add('flex')
    }
    
    // Funci?n para cerrar el modal
    const closeModal = (disableEffects = false) => {
      modal.classList.add('hidden')
      modal.classList.remove('flex')
      
      // Marcar que el modal se mostr? en esta sesi?n (solo para esta sesi?n, no persiste)
      sessionStorage.setItem('browser-modal-shown-session', 'true')
      
      // Si el usuario decidi? continuar sin Firefox, deshabilitar efectos solo para esta sesi?n
      if (disableEffects && !isFirefox) {
        sessionStorage.setItem('disable-3d-effects-session', 'true')
        localStorage.setItem('disable-3d-effects', 'true')
        // Disparar evento para que los componentes se actualicen
        window.dispatchEvent(new CustomEvent('disable-3d-effects'))
      }
    }
    
    closeBtn.addEventListener('click', () => closeModal(false))
    continueBtn.addEventListener('click', () => closeModal(true))
    
    // Cerrar al hacer click fuera del modal
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal(false)
      }
    })
    
    // Cerrar con ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModal(false)
      }
    })
  }
  
  // Inicializar cuando el DOM est? listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBrowserModal)
  } else {
    initBrowserModal()
  }
  
  // Reinicializar en transiciones de Astro
  document.addEventListener('astro:page-load', initBrowserModal)
</script>

<style>
  #browser-modal {
    animation: fadeIn 0.3s ease-out;
  }
  
  #browser-modal > div {
    animation: slideUp 0.3s ease-out;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  @keyframes slideUp {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
</style>
