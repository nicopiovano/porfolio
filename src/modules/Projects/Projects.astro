---
import GitHub from "@/components/icons/GitHub.astro"
import Quasar from "@/components/icons/Quasar.astro"
import React from "@/components/icons/React.astro"
import Vite from "@/components/icons/Vite.astro"
import Vue from "@/components/icons/Vue.astro"
import Motion from "@/components/icons/Motion.astro"
import Tailwind from "@/components/icons/Tailwind.astro"
import AstroIcon from "@/components/icons/AstroIcon.astro"
import Laravel from "@/components/icons/Laravel.astro"
import Link from "@/components/icons/Link.astro"
import LinkButton from "@/modules/LinkButton/LinkButton.astro"

const { t } = Astro.locals as any
const content = (Astro.props as any)?.content ?? t.projects

// En local (npm run dev) los links apuntan a localhost; en producción a las URLs desplegadas
const isDev = import.meta.env.DEV
const PROJECT_LINKS = {
  login: isDev ? "http://localhost:5171/" : "https://nico-piovano-login.vercel.app/",
  marketDashboard: isDev ? "http://localhost:5172/" : "https://nico-piovano-market-dashboard.vercel.app/",
  rifas: isDev ? "http://localhost:5173/" : "https://nico-piovano-rifas.vercel.app/",
  techDecision: isDev ? "http://localhost:5174/" : "https://nico-piovano-tech-decision.vercel.app/",
}

const TAGS = {
  QUASAR: {
    name: "Quasar",
    class: "bg-[#7a95ff] text-white",
    icon: Quasar,
    url: "https://quasar.dev",
  },
  REACT: {
    name: "React",
    class: "bg-[#61dafb] text-light-gray",
    icon: React,
    url: "https://react.dev",
  },
  VITE: {
    name: "Vite",
    class: "bg-[#646cff] text-white",
    icon: Vite,
    url: "https://vitejs.dev",
  },
  VUE: {
    name: "Vue",
    class: "bg-[#42b883] text-white",
    icon: Vue,
    url: "https://vuejs.org",
  },
  MOTION: {
    name: "Motion",
    class: "bg-[#dbf20c] text-dark",
    icon: Motion,
    url: "https://motion.dev/",
  },
  TAILWIND: {
    name: "Tailwind CSS",
    class: "bg-[#003159] text-white",
    icon: Tailwind,
    url: "https://tailwindcss.com",
  },
  ASTRO: {
    name: "Astro",
    class: "bg-[#FF5D01] text-white",
    icon: AstroIcon,
    url: "https://astro.build",
  },
  LARAVEL: {
    name: "Laravel",
    class: "bg-[#FF2D20] text-white",
    icon: Laravel,
    url: "https://laravel.com",
  },
}

const PROJECTS_DATA = [
  {
    link: PROJECT_LINKS.login,
    github: "https://github.com/nicopiovano/login-react",
    image: "/projects/panel-logueo.png",
    tags: [TAGS.REACT, TAGS.TAILWIND, TAGS.LARAVEL],
  },
  {
    link: PROJECT_LINKS.marketDashboard,
    github: "https://github.com/nicopiovano/market-dashboard",
    image: "/projects/market-dashboard.png",
    tags: [TAGS.VUE, TAGS.VITE, TAGS.TAILWIND],
  },
  {
    link: PROJECT_LINKS.techDecision,
    github: "https://github.com/nicopiovano/tech-decision",
    image: "/projects/tech-decision.png",
    tags: [TAGS.VUE, TAGS.VITE, TAGS.TAILWIND],
  },
  {
    link: PROJECT_LINKS.rifas,
    github: "https://github.com/nicopiovano/rifas-react",
    image: "/projects/rifas.png",
    tags: [TAGS.REACT, TAGS.MOTION, TAGS.TAILWIND],
  },
  {
    link: null,
    github: "https://github.com/nicopiovano/porfolio",
    image: "/projects/porfolio.png",
    tags: [TAGS.ASTRO, TAGS.VITE, TAGS.TAILWIND],
  },
  {
    link: null,
    github: null,
    image: "/projects/chat.png",
    tags: [TAGS.TAILWIND],
  },
]

const PROJECTS = PROJECTS_DATA.map((project, i) => ({
  ...project,
  title: content.items[i]?.title || '',
  description: content.items[i]?.description || '',
  problem: content.items[i]?.problem || '',
  solution: content.items[i]?.solution || '',
  impact: content.items[i]?.impact || '',
}))

const LABELS = content?.labels ?? {
  problem: "Problema",
  solution: "Solución",
  impact: "Impacto",
  stack: "Stack",
}
---

<section class="projects-section">
  <!-- CONTENEDOR STICKY CON CARRUSEL -->
  <div class="sticky top-0 h-[80vh] md:h-[85vh] overflow-hidden projects-carousel-container">
    <div class="projects-wrapper relative h-full">
      {PROJECTS.map((project, i) => (
        <div class="project-card" data-index={i}>
          <div class="card-box">
            <!-- Fondo: imagen con opacity y blur -->
            <div
              class="card-box-bg"
              style={`background-image: url(${project.image})`}
              aria-hidden="true"
            />
            <!-- Overlay para legibilidad del texto -->
            <div class="card-box-overlay" />
            <!-- Contenido encima -->
            <article class="project-card-article">
              <h3 class="project-card-title">
                {project.title}
              </h3>

              <ul class="flex flex-wrap gap-2 mt-3">
                {project.tags.map((tag) => (
                  <li>
                    <a
                      href={tag.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      class={`flex items-center gap-x-2 rounded-full text-xs ${tag.class} py-1 px-2 hover:opacity-90 transition-opacity`}
                    >
                      {tag.icon === Quasar && <Quasar class="size-4" />}
                      {tag.icon === React && <React class="size-4" />}
                      {tag.icon === Vite && <Vite class="size-4" />}
                      {tag.icon === Vue && <Vue class="size-4" />}
                      {tag.icon === Motion && <Motion class="size-4" />}
                      {tag.icon === Tailwind && <Tailwind class="size-4" />}
                      {tag.icon === AstroIcon && <AstroIcon class="size-4" />}
                      {tag.icon === Laravel && <Laravel class="size-4" />}
                      {tag.name}
                    </a>
                  </li>
                ))}
              </ul>

              <div class="project-card-description">
                {project.problem || project.solution || project.impact ? (
                  <div class="space-y-3">
                    {project.problem && (
                      <p><span class="font-semibold">{LABELS.problem}:</span> {project.problem}</p>
                    )}
                    {project.solution && (
                      <p><span class="font-semibold">{LABELS.solution}:</span> {project.solution}</p>
                    )}
                    {project.impact && (
                      <p><span class="font-semibold">{LABELS.impact}:</span> {project.impact}</p>
                    )}
                  </div>
                ) : (
                  <p>{project.description}</p>
                )}
              </div>

              <footer class="flex gap-x-4 mt-6">
                {project.github && (
                  <LinkButton href={project.github}>
                    <GitHub class="size-6" />
                    Code
                  </LinkButton>
                )}
                {project.link && (
                  <LinkButton href={project.link}>
                    <Link class="size-4" />
                    {t.projects.preview}
                  </LinkButton>
                )}
              </footer>
            </article>
          </div>
        </div>
      ))}
      
      <!-- Navegación del carrusel -->
      <button class="carousel-btn carousel-btn-prev" aria-label="Proyecto anterior">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m15 18-6-6 6-6"/>
        </svg>
      </button>
      <button class="carousel-btn carousel-btn-next" aria-label="Proyecto siguiente">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m9 18 6-6-6-6"/>
        </svg>
      </button>
      
      <!-- Indicadores (dots) -->
      <div class="carousel-dots">
        {PROJECTS.map((_, i) => (
          <button class="carousel-dot" data-index={i} aria-label={`Ir al proyecto ${i + 1}`}></button>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
.projects-section {
  position: relative;
  min-height: 100vh;
  padding: 2rem 0;
}

.projects-carousel-container {
  position: relative;
}

.projects-wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}

.project-card {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  opacity: 0;
  transform: translateX(100%);
  transition: opacity 0.5s ease, transform 0.5s ease;
  pointer-events: none;
}

.project-card.active {
  opacity: 1;
  transform: translateX(0);
  z-index: 10;
  pointer-events: auto;
}

.project-card.prev {
  transform: translateX(-100%);
}

.card-box {
  position: relative;
  width: 90%;
  max-width: 1200px;
  height: 100%;
  border-radius: 2rem;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Imagen de fondo con opacity y blur */
.card-box-bg {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  opacity: 0.6;
  filter: blur(5px);
  transform: scale(1.05);
}

/* Overlay para que el texto sea legible (más claro) */
.card-box-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.38);
  pointer-events: none;
}

:global(html.dark) .card-box-overlay {
  background: rgba(0, 0, 0, 0.5);
}

.project-card-article {
  position: relative;
  z-index: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  width: 100%;
  height: 100%;
  padding: 1.5rem 2rem;
  min-height: 0;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.project-card-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #fff;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
  line-height: 1.3;
}

.project-card-description {
  margin-top: 1rem;
  color: rgba(255, 255, 255, 0.92);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
  line-height: 1.5;
  font-size: 0.95rem;
}

/* Botones de navegación */
.carousel-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 20;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #333;
}

.carousel-btn:hover {
  background: rgba(255, 255, 255, 1);
  transform: translateY(-50%) scale(1.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.carousel-btn-prev {
  left: 1rem;
}

.carousel-btn-next {
  right: 1rem;
}

:global(html.dark) .carousel-btn {
  background: rgba(15, 23, 42, 0.9);
  border-color: rgba(255, 255, 255, 0.1);
  color: #fff;
}

:global(html.dark) .carousel-btn:hover {
  background: rgba(15, 23, 42, 1);
}

/* Indicadores (dots) */
.carousel-dots {
  position: absolute;
  bottom: 1rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 20;
  display: flex;
  gap: 0.5rem;
}

.carousel-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: none;
  background: rgba(0, 0, 0, 0.3);
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
}

.carousel-dot.active {
  background: rgba(120, 216, 115, 0.8);
  transform: scale(1.2);
}

:global(html.dark) .carousel-dot {
  background: rgba(255, 255, 255, 0.3);
}

:global(html.dark) .carousel-dot.active {
  background: rgba(120, 216, 115, 0.8);
}

@media (max-width: 768px) {
  .card-box {
    width: 95%;
    min-height: 72vh;
    height: 72vh;
    max-height: 72vh;
    align-items: stretch;
  }

  .project-card-article {
    padding: 1.25rem 1.5rem;
  }

  .project-card-title {
    font-size: 1.35rem;
  }
  
  .project-card {
    padding: 0.5rem;
  }
  
  .carousel-btn {
    width: 40px;
    height: 40px;
  }
  
  .carousel-btn-prev {
    left: 0.5rem;
  }
  
  .carousel-btn-next {
    right: 0.5rem;
  }
}

@media (max-width: 480px) {
  .card-box {
    width: 98%;
    min-height: 70vh;
    height: 70vh;
    max-height: 70vh;
  }

  .project-card-article {
    padding: 1rem 1.25rem;
  }
  
  .carousel-btn {
    width: 36px;
    height: 36px;
  }
  
  .carousel-dots {
    bottom: 0.5rem;
  }
}
</style>

<script src="./Projects.astro.js"></script>
